# S3-Crypt-Proxy Configuration Example
# Copy to config.yaml and customize

# Address for the S3 proxy endpoint (clients connect here)
listen_addr: ":8080"

# Address for the admin API endpoint (key management, metrics)
admin_listen_addr: ":8081"

# Backend S3 storage configuration
backend:
  # S3 endpoint URL
  endpoint: "https://s3.amazonaws.com"
  # AWS region
  region: "us-east-1"
  # Backend credentials (use environment variables in production)
  access_key: "${S3CP_BACKEND_ACCESS_KEY}"
  secret_key: "${S3CP_BACKEND_SECRET_KEY}"
  # Use path-style URLs (required for MinIO, optional for AWS)
  path_style: false
  # Skip TLS verification (NOT recommended for production)
  insecure_skip_verify: false

# Client authentication (what PBS will use to connect)
client:
  access_key: "${S3CP_CLIENT_ACCESS_KEY}"
  secret_key: "${S3CP_CLIENT_SECRET_KEY}"

# Encryption settings
encryption:
  # Chunk size for streaming encryption (default 4MB)
  chunk_size: 4194304

# Allowed buckets - restrict which buckets clients can access
# If empty or not set, all buckets from backend are allowed (not recommended)
# ListBuckets will return only these buckets
allowed_buckets:
  - "my-backup-bucket"
  # - "another-bucket"

# Admin API settings
admin:
  # Bearer token for admin API authentication
  token: "${S3CP_ADMIN_TOKEN}"

# TLS configuration (optional)
tls:
  cert_file: ""
  key_file: ""

# Memkey server configuration (for key retrieval)
memkey:
  # Unix socket for secure local key transfer (recommended)
  # The proxy connects to this socket to fetch the encryption key
  socket_path: "/run/memkey/memkey.sock"
  
  # HTTP endpoint for status checks (optional fallback)
  # Only used if socket_path is not set or unavailable
  endpoint: "http://127.0.0.1:7070"
  
  # How often to poll for key availability
  poll_interval: "5s"
  
  # Skip TLS verification for HTTP endpoint (if using HTTPS)
  insecure_skip_verify: false

# Logging
log_level: "info"  # debug, info, warn, error
